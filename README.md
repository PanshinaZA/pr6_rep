# Практическая работа №6. SQL для подготовки данных
## Цель:
Использовать внешний набор данных для выявления тенденций продаж. Рассмотреть данные переписи населения США об использовании общественного транспорта относительно ZIP-кода. Проанализировать, имеется ли корреляция между уровнем использования общественного транспорта с продажами в организации в определенном регионе.

## Ход работы:
1. Необходимо создать таблицу в базе клиентов организации, в которую будем вносить набор данных, для этого подключимся к библиотеке `psycopg2` и установим соединение с PostgreSQL:

  ![image](https://github.com/user-attachments/assets/0095d314-ebce-4618-a907-e398eaec2cee)
  ![image](https://github.com/user-attachments/assets/98f9e00e-c313-4331-b36f-5931c30339c0)
  ![1](https://github.com/user-attachments/assets/dd134aae-0592-4ad8-85bf-66a077f8323c)

2. Затем внесем набор данных в созданную таблицу с помошью `COPY file`:

![image](https://github.com/user-attachments/assets/343f2842-2254-482f-8a58-03057da05967)
![image](https://github.com/user-attachments/assets/fdbc6212-557c-4c31-90fc-4517db2ba886)

3.  Найдем максимальное и минимальное процентное соотношение в данных. Значения ниже 0 принять как пустое значение.

![image](https://github.com/user-attachments/assets/ec9738d7-fa28-46c8-b44d-3f3326f39ac1)
![image](https://github.com/user-attachments/assets/6fa241ef-8983-44ab-bf13-1227bef90070)

4. Рассчитаем средний объем продаж для клиентов, проживающих в регионах с высоким уровнем использования общественного транспорта (более 10%), а также с низким уровнем использования общественного транспорта
(менее или равным 10%).

Для выполнения задания необходимо связать таблицу `public_transportation_statistics_by_zip_code` с таблицей `sales`. Так как у них нет столбца, через который можно провести связь, свяжем таблицы `public_transportation_statistics_by_zip_code` и `customers` через поля `zip_code`/`postal_code` и таблицы `sales` и `customers` через поле `customer_id`. С помощью конструкции `case` разделим клиентов на две группы - с высоким и с низким уровнем использования общественного транспорта, в конце проведем группировку по данным категориям:
![image](https://github.com/user-attachments/assets/90d712bc-638f-4191-948d-ae26278365b9)
![image](https://github.com/user-attachments/assets/d755548f-55dc-4a0c-971f-b2ce66ce5f72)

5. Загрузим данные в pandas и построим гистограмму распределения(использовать my_data.plot.hist(y='public_transportation_pct') для построения гистограммы)

![image](https://github.com/user-attachments/assets/d91adcc1-806e-4825-9169-530aff9891e7)
![image](https://github.com/user-attachments/assets/49b5c2b9-c2ab-43db-9900-553785d16c05)
![image](https://github.com/user-attachments/assets/f21402cc-229f-4320-a6a0-15960078045c)

6. Сгруппируем клиентов по их zip_code, и посмотрим на среднее количество транзакций на одного клиента. Экспортируем эти данные в Excel и создадим диаграмму рассеяния, чтобы лучше понять взаимосвязь между использованием общественного транспорта и продажами.

Для выполнения задания необходимо вывести zip_code, количество транзакций, количество уникальных покупателей, среднее количество транзакций(количество транзакций на количество клиентов). Средний объем продаж и процент использования общественного транспорта выведем, чтобы позже построить диаграмму рассеяния. Опять же таки свяжем таблицы так же, как в прошлом задании. Сгруппируем все по полю `zip_code`. Кроме того, учитываем только те данные, где процент использования общественного транспорта больше 0.

![image](https://github.com/user-attachments/assets/796c96cf-f9de-405b-aaa7-840fee73f3d2)
![image](https://github.com/user-attachments/assets/95693ec5-7ef8-47fa-bab2-6f7bf2759d5a)

`analysis_sales.csv` — файл, в который мы экспортировали данные, находится в репозитории.

`Panshina_Zinaida_Alekseevna_pr6.ipynb` — Jupyter Notebook с выполнением всех заданий, файл находится в репозитории.

7. На основании этого анализа, рассмотрим какие рекомендации можно дать руководству компании при рассмотрении возможностей расширения.

Диаграмма рассеяния наглядно показывает корреляцию между уровнем использования общественного транспорта и средним уровнем продаж организации. Чем выше уровень использования общественного транспорта, тем ниже продажи. На основе этого можно сделать вывод, что при расширении компании целесообразнее создавать точки в районах с низким уровнем использованием общественного транспорта. Однако стоит также учитывать другие факторы, например, проанализировать стоит ли вообще создавать физическую точку или лучше расширить свои возможности онлайн продаж, которые в результате данного анализа могут помочь, а могут и не помочь в повышении среднего уровня объема продаж в районах с высоким уровнем использования общественного транспорта. 

Как итог, при поверхностном анализе на основе лишь фактора использования общественного транпсорта стоит расширять организацию в тех районах, где низкий уровень использования общественного транспорта. Но для более успешного решения о расширении компании необходимо проводить более глубокий анализ, учитывающий множество факторов.
## Выводы:
В ходе выполнения лабораторной работы было успешно освоено использование внешнего набора данных для выявления тенденций продаж, а также рассмотрены данные переписи населения США об использовании общественного транспорта относительно ZIP-кода. Были построены гистограмма распределения и диаграмма рассеяния, на основе которых был сделан анализ корреляции уровня использования общественного транспорта со средним объемом продаж организации в определенных регионах.
